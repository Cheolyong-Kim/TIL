# 추천 시스템 코드 분석

<br>

여러가지 추천 시스템 코드를 분석하여 어떤 구조로 동작하는지 익혀본다.

<br>

### CBF

<br>

![j1](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j1.png?raw=true)

기본적인 패키지를 불러온다.

<br>

![j2](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j2.png?raw=true)

[케글](https://www.kaggle.com/datasets/tmdb/tmdb-movie-metadata)에서 TMDB데이터를 받아서 사용한다.

영화에 관련된 여러 속성들을 볼 수 있다.

<br>

![j3](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j3.png?raw=true)

info 메소드를 사용해서 데이터프레임의 정보를 확인한다.

<br>

![j4](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j4.png?raw=true)

여기서 영화 추천을 위해 필요한 속성들만 추출해낸다.

<br>

![j5](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j5.png?raw=true)

장르 속성의 값이 특이한데 모양은 리스트와 딕셔너리 구조로 보이지만 저장될 때는 str타입으로 저장되어 있다.

<br>

![j6](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j6.png?raw=true)

literal_eval 라이브러리를 사용해서 문자열 내의 표현식을 인식할 수 있게 만들어 준다.

파싱한 후에 데이터 타입을 보면 list로 변해있는 것을 확인할 수 있다.

<br>

![j7](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j7.png?raw=true)

장르 속성의 값들이 잘 파싱이 되었고, 한 영화에 여러가지 장르가 표현되어 있는 것을 확인할 수 있다.

<br>

![j8](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j8.png?raw=true)

장르 속성에서 id값은 필요없기 때문에 apply 메소드를 통해 데이터 프레임에 일괄로 lambda 함수를 적용하여 장르 이름만 사용하도록 한다.

<br>

![j9](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j9.png?raw=true)

장르를 벡터화시킬 때 CountVectorizer를 사용한다.

위 이미지는 CountVectorizer가 어떤 동작을 하는지 보여준다.

<br>

![j10](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j10.png?raw=true)

우선 콤마로 각 영화별로 구분되어 있는 장르 리스트를 빈칸을 구분자로하여 합쳐준다.

<br>

![j11](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j11.png?raw=true)

CountVectorizer의 ngram_range를 1~2로 지정하여 장르 단어들이 하나씩, 그리고 두 단어 씩 연결하여(2-gram) 단어 사전에 들어가도록 한다(romance action -> [romance, action, romance action]). 

<br>

![j12](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j12.png?raw=true)

코사인 유사도를 사용해서 장르 단어 사전의 코사인 유사도 매트릭스를 만든다.

<br>

![j13](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j13.png?raw=true)

코사인 유사도 매트릭스의 각 영화별로 유사도를 역순으로 정렬하여 유사도가 높은 영화의 인덱스를 앞에서부터 순서대로 보여주게 한다.

<br>

![j14](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j14.png?raw=true)

Avatar 영화의 인덱스를 통해서 유사도가 높은 인덱스를 출력해본다.

<br>

![j15](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j15.png?raw=true)

후에 데이터 프레임에서 인덱스를 통해 영화 이름을 찾기 위해 결과로 나온 유사도 매트릭스의 차원을 하나 낮춰준다.

<br>

![j16](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j16.png?raw=true)

유사도 인덱스를 데이터 프레임에 입력해서 결과를 출력한다.

<br>

![j17](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j17.png?raw=true)

위 과정을 함수로 정의한다.

<br>

![j18](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j18.png?raw=true)

함수를 통해 입력한 영화와 비슷한 영화를 추천해준 결과이다.

<br>

![j19](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j19.png?raw=true)

그런데 예제에서는 평점 기반으로 추천하고 싶은데, vote_count가 낮은 영화가 섞여 있어 문제가 생긴다. (vote_count가 1인데 평점이 10.0인 데이터가 존재하는 등 문제 발생)

<br>

![j20](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j20.png?raw=true)

그래서 예제에서는 가중평점이라는 값을 만들어 vote_count가 높은 영화에 가중치를 부여하여 vote_count가 낮은 영화들은 추천에서 제외할 수 있도록 한다.

<br>

![j21](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j21.png?raw=true)

가중평점을 계산하는 함수를 정의한다.

<br>

![j22](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j22.png?raw=true)

가중평점 계산 함수를 데이터프레임의 각 데이터에 적용하여 새로운 weighted_vote 열을 생성한다.

<br>

![j23](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j23.png?raw=true)

영화들을 weighted_vote 순으로 정렬한 모습이다.

<br>

![j24](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j24.png?raw=true)

가중평점을 활용하여 새로운 영화 추천 함수를 정의한다.

<br>

![j25](https://github.com/Cheolyong-Kim/TIL/blob/master/%EA%B8%B0%ED%83%80/%EC%B6%94%EC%B2%9C%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20image/j25.png?raw=true)

새로 만든 함수를 적용한 결과이다.

이전 함수와 다르게 평점이 의미있을 수준의 vote_count를 가진 영화들이 추천된다.

<br>

---

